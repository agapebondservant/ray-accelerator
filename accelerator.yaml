accelerator:
  displayName: Bitnami KubeRay Accelerator
  description: Template for deploying Bitnami Kuberay to TAP
  iconUrl: https://static-00.iconduck.com/assets.00/airflow-icon-512x512-tpr318yf.png
  tags:
    - "ML"
    - "AI"
    - "datascience"
    - "MLOps"
    - "ray"
  options:
    - name: ray
      inputType: radio
      display: true
      choices:
        - text: 'Ray (ML Training)'
          value: selected
      defaultValue: selected
      dependsOn:
        name: mlPlatformType
        value: training
    - name: mlPlatformType
      inputType: radio
      display: true
      choices:
        - text: 'View guidance manual: https://github.com/bitnami/charts/tree/main/bitnami/airflow'
          value: training
      defaultValue: training
    - name: clusterHeadResourcesLimitsMemory
      inputType: text
      display: true
      label: 'cluster.head.resources.limits.memory'
      defaultValue: '8G'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: clusterHeadResourcesRequestsMemory
      inputType: text
      display: true
      label: 'cluster.head.resources.requests.memory'
      defaultValue: '8G'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: clusterWorkerCommonResourcesLimitsMemory
      inputType: text
      display: true
      label: 'cluster.worker.common.resources.limits.memory'
      defaultValue: '8G'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: clusterWorkerCommonResourcesRequestsMemory
      inputType: text
      display: true
      label: 'cluster.worker.common.resources.requests.memory'
      defaultValue: '8G'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayOperatorServiceType
      inputType: text
      display: true
      label: 'operator.service.type'
      defaultValue: 'LoadBalancer'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayApiserverServiceType
      inputType: text
      display: true
      label: 'apiserver.service.type'
      defaultValue: 'LoadBalancer'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayProxyIngressEnabled
      inputType: text
      display: true
      label: 'proxy.ingress.enabled'
      defaultValue: 'true'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayProxyIngressHostname
      inputType: text
      display: true
      label: 'proxy.ingress.hostname'
      defaultValue: 'yourhostname.com'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayProxyIngressAnnotationsWebsocketRoutes
      inputType: text
      display: true
      label: 'proxy.ingress.annotations.websocket.routes'
      defaultValue: '/'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayProxyIngressTls
      inputType: text
      display: true
      label: 'proxy.ingress.tls'
      defaultValue: 'true'
      dependsOn:
        name: mlPlatformType
        value: training
    - name: rayProxyIngressSelfSigned
      inputType: text
      display: true
      label: 'proxy.ingress.selfSigned'
      defaultValue: 'true'
      dependsOn:
        name: mlPlatformType
        value: training
engine:
  type: Merge
  sources:
    - type: Chain
      transformations:
        - type: Include
          patterns: [ '**/**.yaml' ]
        - type: Exclude
          patterns: [ 'catalog-info.yaml' ]
        - type: ReplaceText
          substitutions:
            - text: REPLACE_CLUSTER_HEAD_RESOURCES_LIMITS_MEMORY
              with: "#clusterHeadResourcesLimitsMemory"
            - text: REPLACE_CLUSTER_HEAD_RESOURCES_REQUESTS_MEMORY
              with: "#clusterHeadResourcesRequestsMemory"
            - text: REPLACE_CLUSTER_WORKER_COMMON_RESOURCES_LIMITS_MEMORY
              with: "#clusterWorkerCommonResourcesLimitsMemory"
            - text: REPLACE_CLUSTER_WORKER_COMMON_RESOURCES_REQUESTS_MEMORY
              with: "#clusterWorkerCommonResourcesRequestsMemory"
            - text: REPLACE_RAY_OPERATOR_SERVICE_TYPE
              with: "#rayOperatorServiceType"
            - text: REPLACE_RAY_API_SERVER_SERVICE_TYPE
              with: "#rayApiserverServiceType"
            - text: REPLACE_RAY_PROXY_INGRESS_ENABLED
              with: "#rayProxyIngressEnabled"
            - text: REPLACE_RAY_PROXY_INGRESS_HOSTNAME
              with: "#rayProxyIngressHostname"
            - text: REPLACE_RAY_PROXY_INGRESS_ANNOTATIONS_WEBSOCKETROUTES
              with: "#rayProxyIngressAnnotationsWebsocketRoutes"
            - text: REPLACE_RAY_PROXY_INGRESS_TLS
              with: "#rayProxyIngressTls"
            - text: REPLACE_RAY_PROXY_INGRESS_SELF_SIGNED
              with: "#rayProxyIngressSelfSigned"

